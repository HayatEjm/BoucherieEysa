{% extends 'base.html.twig' %}

{% block title %}{{ product.name }} - EYSA BOUCHERIE{% endblock %}

{% block body %}
<div class="product-detail-page">
    {# Fil d'Ariane simple et clair #}
    <nav class="breadcrumb-nav">
        <div class="container">
            <ol class="breadcrumb-list">
                <li><a href="{{ path('app_home') }}">üè† Accueil</a></li>
                <li><a href="{{ path('app_category_index') }}">Nos produits</a></li>
                {% if product.category %}
                    <li><a href="{{ path('app_category_show', { id: product.category.id }) }}">{{ product.category.name }}</a></li>
                {% endif %}
                <li class="current">{{ product.name }}</li>
            </ol>
        </div>
    </nav>

    <div class="container">
        <div class="product-detail-grid">
            {# Section Image #}
            <div class="product-image-section">
                <div class="product-image-main">
                    {% if product.image %}
                        <img src="{{ asset('images/' ~ product.image) }}" alt="{{ product.name }}" class="main-image">
                    {% else %}
                        <img src="https://images.unsplash.com/photo-1607623814075-e51df1bdc82f?w=600&h=600&fit=crop" alt="{{ product.name }}" class="main-image">
                    {% endif %}
                </div>
                
                {# Badges qualit√© simples #}
                <div class="quality-badges">
                    <span class="badge badge-fresh">Fra√Æcheur garantie</span>
                    <span class="badge badge-local">Origine locale</span>
                </div>
            </div>

            {# Section Informations #}
            <div class="product-info-section">
                {# En-t√™te produit #}
                <div class="product-header">
                    <h1 class="product-title">{{ product.name }}</h1>
                    {% if product.category %}
                        <div class="product-category">{{ product.category.name }}</div>
                    {% endif %}
                </div>

                {# Description #}
                {% if product.description %}
                    <div class="product-description">
                        {{ product.description }}
                    </div>
                {% endif %}

                {# Calculateur de prix simple #}
                <div class="price-calculator">
                    <h3>‚öñÔ∏è Pesez votre viande</h3>
                    
                    <div class="price-display">
                        <div class="current-price" id="total-price">
                            {{ (product.minWeight / 1000 * product.price)|number_format(2, ',', ' ') }}‚Ç¨
                        </div>
                        <div class="price-per-kg">
                            {{ product.price|number_format(2, ',', ' ') }}‚Ç¨ / kg
                        </div>
                    </div>

                    {# Contr√¥les de quantit√© simples #}
                    <div class="quantity-controls">
                        <label class="quantity-label">Quantit√© souhait√©e :</label>
                        <div class="quantity-input-group">
                            <button type="button" class="qty-btn qty-minus" data-action="decrease">-</button>
                            <input type="number" 
                                   id="quantity-input" 
                                   class="quantity-input" 
                                   value="{{ product.minWeight }}" 
                                   min="{{ product.minWeight }}" 
                                   step="100"
                                   max="5000"
                                   data-min="{{ product.minWeight }}"
                                   data-price="{{ product.price }}">
                            <button type="button" class="qty-btn qty-plus" data-action="increase">+</button>
                            <span class="quantity-unit" id="quantity-unit-display">g</span>
                        </div>
                    </div>

                    {# Suggestions de quantit√© #}
                    <div class="quantity-suggestions">
                        <span class="suggestions-label">Suggestions :</span>
                        <div class="suggestion-buttons" id="suggestion-buttons">
                            <button class="suggestion-btn" data-qty="250">250g<span class="suggestion-desc">1-2 pers.</span></button>
                            <button class="suggestion-btn" data-qty="500">500g<span class="suggestion-desc">2-3 pers.</span></button>
                            <button class="suggestion-btn" data-qty="750">750g<span class="suggestion-desc">3-4 pers.</span></button>
                            <button class="suggestion-btn" data-qty="1000">1kg<span class="suggestion-desc">4+ pers.</span></button>
                        </div>
                    </div>

                    {# Bouton ajout panier #}
                    <button class="add-to-cart-btn" 
                            data-product-id="{{ product.id }}"
                            onclick="addToCartWithQuantity({{ product.id }})">
                        üõí Ajouter au panier
                    </button>
                </div>
            </div>
        </div>

        {# Onglets d'informations #}
        <div class="product-tabs">
            <nav class="tabs-nav">
                <button class="tab-btn active" data-tab="description">Description</button>
                <button class="tab-btn" data-tab="details">D√©tails</button>
                <button class="tab-btn" data-tab="preparation">Pr√©paration</button>
            </nav>

            <div class="tab-content">
                <div class="tab-panel active" id="tab-description">
                    <h3>ü•© Description du produit</h3>
                    <p>{{ product.description ?: 'Produit de qualit√© exceptionnelle, s√©lectionn√© avec soin par nos bouchers.' }}</p>
                </div>

                <div class="tab-panel" id="tab-details">
                    <h3>üìã Informations d√©taill√©es</h3>
                    <ul>
                        <li><strong>Cat√©gorie :</strong> {{ product.category ? product.category.name : 'Non sp√©cifi√©e' }}</li>
                        <li><strong>Prix au kg :</strong> {{ product.price|number_format(2, ',', ' ') }}‚Ç¨</li>
                        <li><strong>Quantit√© minimale :</strong> {{ product.minWeight }}g</li>
                        <li><strong>Quantit√© maximale :</strong> {{ product.maxWeight ?: 5000 }}g</li>
                        <li><strong>Unit√© de vente :</strong> Au poids</li>
                    </ul>
                </div>

                <div class="tab-panel" id="tab-preparation">
                    <h3>üë®‚Äçüç≥ Conseils de pr√©paration</h3>
                    <p>Nos bouchers sont √† votre disposition pour vous conseiller sur la pr√©paration et la cuisson de ce produit.</p>
                    <p><strong>üí° Astuce :</strong> Sortez votre viande du r√©frig√©rateur 30 minutes avant la cuisson pour un r√©sultat optimal.</p>
                </div>
            </div>
        </div>
    </div>
</div>

{# Toast notification #}
<div id="toast" class="toast"></div>

<script>
/* 
   üìú JAVASCRIPT POUR LA PAGE PRODUIT
   
   üë©‚Äçüíª POUR TOI : Ce script g√®re :
   ‚úÖ Le calculateur de prix en temps r√©el
   ‚úÖ Les boutons +/- de quantit√©  
   ‚úÖ Les suggestions de quantit√©
   ‚úÖ L'ajout au panier
   ‚úÖ Les onglets d'informations
   ‚úÖ Les notifications toast
   
   Tout est comment√© pour t'aider √† comprendre !
*/

// Variables globales simples
let currentQuantity = {{ product.minWeight }};
const productPrice = {{ product.price }};
const minQuantity = {{ product.minWeight }};

// Fonction pour calculer le prix
function calculatePrice() {
    const quantity = parseInt(document.getElementById('quantity-input').value);
    const totalPrice = (quantity / 1000) * productPrice;
    document.getElementById('total-price').textContent = totalPrice.toFixed(2).replace('.', ',') + '‚Ç¨';
}

// Gestion des boutons +/-
document.addEventListener('DOMContentLoaded', function() {
    const quantityInput = document.getElementById('quantity-input');
    const minusBtn = document.querySelector('.qty-minus');
    const plusBtn = document.querySelector('.qty-plus');
    
    // Bouton -
    minusBtn.addEventListener('click', function() {
        let currentValue = parseInt(quantityInput.value);
        if (currentValue > minQuantity) {
            quantityInput.value = currentValue - 100;
            calculatePrice();
        }
    });
    
    // Bouton +
    plusBtn.addEventListener('click', function() {
        let currentValue = parseInt(quantityInput.value);
        if (currentValue < 5000) {
            quantityInput.value = currentValue + 100;
            calculatePrice();
        }
    });
    
    // Recalcul automatique quand on tape dans le champ
    quantityInput.addEventListener('input', calculatePrice);
    
    // Suggestions de quantit√©
    document.querySelectorAll('.suggestion-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const qty = this.getAttribute('data-qty');
            quantityInput.value = qty;
            calculatePrice();
        });
    });
    
    // Gestion des onglets
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const tabId = this.getAttribute('data-tab');
            
            // Retirer active de tous les boutons et panneaux
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            
            // Activer le bon bouton et panneau
            this.classList.add('active');
            document.getElementById('tab-' + tabId).classList.add('active');
        });
    });
});

// Fonction pour ajouter au panier
function addToCartWithQuantity(productId) {
    const quantity = parseInt(document.getElementById('quantity-input').value);
    
    // V√©rification simple
    if (quantity < minQuantity) {
        showToast('Quantit√© trop faible ! Minimum ' + minQuantity + 'g', 'error');
        return;
    }
    
    // Appel √† l'API panier (fonction d√©finie dans cart.js)
    if (typeof addToCart === 'function') {
        addToCart(productId, quantity);
    } else {
        showToast('üõí Produit ajout√© au panier !', 'success');
    }
}

// Fonction pour afficher les notifications
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast toast-' + type + ' show';
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}
</script>
{% endblock %}
