{% extends 'admin/admin_base.html.twig' %}
{% block title %}Gestion des Commandes{% endblock %}

{% block body %}
<div class="admin-header">
  <h1><i class="fas fa-shopping-cart"></i> Commandes</h1>
  <p class="subtitle">Visualisez et gérez les commandes</p>
</div>

<div class="admin-actions" style="margin-bottom:20px;">
  <a href="{{ path('admin_orders_export') }}" class="btn btn-info"><i class="fas fa-download"></i> Export CSV</a>
</div>

<div class="admin-table">
  <table>
    <thead>
      <tr>
        <th>N°</th>
        <th>Client</th>
        <th>Date</th>
        <th>Retrait</th>
        <th>Total</th>
        <th>Statut</th>
        <th style="width:140px;">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
        <tr>
          <td><strong>{{ order.orderNumber ?? ('#' ~ order.id) }}</strong></td>
          <td>
            <div class="customer-info">
              <strong>{{ order.customerName ?: 'Client' }}</strong><br>
              <small style="color:#666;">{{ order.customerEmail }}</small>
              {% if order.customerPhone %}<br><small style="color:#666;"><i class="fas fa-phone"></i> {{ order.customerPhone }}</small>{% endif %}
            </div>
          </td>
          <td>{{ order.createdAt|date('d/m/Y H:i') }}</td>
          <td>
            {% if order.pickupDate or order.pickupTimeSlot %}
              <div class="pickup-info">
                <i class="fas fa-calendar"></i> {{ order.pickupDate ? order.pickupDate|date('d/m/Y') : '-' }}<br>
                <i class="fas fa-clock"></i> {{ order.pickupTimeSlot ?? '-' }}
              </div>
            {% else %}
              <span style="color:#999;">Non défini</span>
            {% endif %}
          </td>
          <td><strong class="price">{{ order.totalTtc|number_format(2, ',', ' ') }}€</strong></td>
          <td><span class="status-badge status-{{ order.status }}">{{ order.status|title }}</span></td>
          <td>
            <div class="btn-group">
              <a href="{{ path('admin_orders_view', {id: order.id}) }}" class="btn btn-sm btn-info"><i class="fas fa-eye"></i></a>
              {# Formulaire simple pour changer le statut #}
              <form method="post" action="{{ path('admin_orders_status', {id: order.id}) }}" style="display:inline-flex; gap:6px;">
                <select name="status" class="form-control" style="width:110px;">
                  {% for s in ['pending','confirmed','ready','completed','cancelled'] %}
                    <option value="{{ s }}" {{ order.status == s ? 'selected' : '' }}>{{ s|title }}</option>
                  {% endfor %}
                </select>
                <button class="btn btn-sm btn-success" title="Enregistrer"><i class="fas fa-save"></i></button>
              </form>
            </div>
          </td>
        </tr>
      {% else %}
        <tr><td colspan="7" style="text-align:center;color:#666;padding:20px;">Aucune commande</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
